---
id: 版本管理
title: 版本管理
sidebar_position: 7
---

Schema Element Editor 提供完善的版本管理功能，包括编辑历史、草稿保存和版本对比。

## 编辑历史

### 功能概述

编辑历史会自动记录您在编辑器中的每次变更，方便回退到之前的版本。


### 记录策略

编辑器自动记录以下类型的历史版本：

| 触发条件    | 版本类型 | 标记 | 说明                        |
| ----------- | -------- | ---- | --------------------------- |
| 编辑后 2 秒 | 自动保存 | ✏️   | 编辑内容后防抖 2 秒自动记录 |
| 点击保存    | 保存版本 | 💾   | 点击保存按钮时立即记录      |

> 💡 **设计说明**：加载草稿或应用收藏后不会立即创建历史记录，而是在用户编辑后通过自动保存机制自然记录。这避免了不必要的历史版本堆积。

### 使用方法

1. 点击工具栏的「历史」下拉按钮
2. 查看版本列表
3. 点击任意版本恢复到该状态

### 版本列表说明

- **时间戳** - 版本创建时间
- **类型图标** - 标识版本类型
- **当前版本** - ✓ 标记 + 高亮背景
- **特殊版本** - 不同图标区分

### 存储策略

| 存储位置     | sessionStorage                  |
| ------------ | ------------------------------- |
| 作用域       | 按元素参数（paramsKey）分别存储 |
| 普通版本上限 | 可配置（默认 50 条）            |
| 特殊版本     | 不计入上限                      |
| 生命周期     | 关闭标签页后清除                |

### 清除历史

点击历史菜单中的「清除历史」按钮：

- 清除所有历史记录
- 保留当前版本作为新的初始记录

## 草稿功能

### 功能概述

草稿功能帮助您保存编辑中的内容，防止意外丢失。

### 手动保存草稿

1. 编辑内容
2. 点击工具栏的「草稿」按钮
3. 选择「保存草稿」

### 加载草稿

1. 点击「草稿」按钮
2. 选择「加载草稿」
3. 确认加载（会覆盖当前内容）

### 自动保存草稿

启用后，编辑器内容变化时会自动保存草稿。

**配置方法**：

1. 打开配置页面
2. 找到「数据管理」→「草稿配置」
3. 开启「草稿自动保存」

### 删除草稿

1. 点击「草稿」按钮
2. 选择「删除草稿」

### 草稿存储

| 项目     | 说明                                    |
| -------- | --------------------------------------- |
| 存储位置 | Chrome 扩展存储（chrome.storage.local） |
| 作用域   | 按元素参数（paramsKey）分别存储         |
| 保留时间 | 默认 1 天，可在配置页面调整             |
| 清理方式 | 自动清理过期草稿或手动删除              |

## 配置选项

### 历史记录配置

在「数据管理」→「历史记录配置」中设置：

| 配置项       | 说明                   | 默认值 |
| ------------ | ---------------------- | ------ |
| 历史记录上限 | 普通版本的最大保存数量 | 50 条  |

> 💡 特殊版本（保存、草稿、收藏）不计入上限。

### 草稿配置

在「数据管理」→「草稿配置」中设置：

| 配置项       | 说明                   | 默认值 |
| ------------ | ---------------------- | ------ |
| 草稿自动保存 | 内容变化时自动保存草稿 | 关闭   |

## 功能开关

在「功能开关」→「功能模块」中可以开启或关闭：

| 功能     | 说明                                       |
| -------- | ------------------------------------------ |
| 草稿功能 | 包含保存草稿、加载草稿、删除草稿、自动保存 |
| 历史记录 | 包含编辑历史记录和版本切换                 |

## 故障排除

### 历史记录丢失

**原因**：历史记录存储在 sessionStorage，关闭标签页后会清除

**预防措施**：

- 重要内容及时保存到页面
- 使用草稿功能持久保存
- 通过历史记录恢复后，点击「添加收藏」按钮永久保存重要版本

### 草稿加载失败

**可能原因**：

1. 草稿已被删除
2. 存储配额已满

**解决方案**：

1. 清理不需要的草稿
2. 检查 Chrome 扩展存储配额
