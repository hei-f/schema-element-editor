# Schema Element 编辑器

Schema Element Editor 内置功能强大的代码编辑器，基于 CodeMirror 6 构建，提供专业的 JSON 编辑体验。

## 编辑器界面

<!-- screenshot: 完整的编辑器界面，标注各个区域 -->

编辑器界面分为以下几个部分：

| 区域         | 说明                       |
| ------------ | -------------------------- |
| **标题栏**   | 显示元素参数、导入导出按钮 |
| **工具栏**   | 提供格式化、转义等操作按钮 |
| **编辑区域** | CodeMirror 代码编辑器      |
| **底部栏**   | 显示内容类型、保存按钮     |

## 工具栏功能

### 内容类型切换

编辑器会自动检测 Schema 数据的类型：

| 类型          | 说明                                   |
| ------------- | -------------------------------------- |
| **AST**       | Elements[] 数组格式，常用于 Agentic UI |
| **RawString** | Markdown 字符串格式                    |
| **JSON**      | 普通 JSON 对象                         |

您可以通过工具栏的切换按钮在 AST 和 RawString 之间转换。

<!-- screenshot: AST/RawString 切换按钮 -->

### 格式化与压缩

| 按钮       | 功能                           | 快捷键    |
| ---------- | ------------------------------ | --------- |
| **格式化** | 将 JSON 格式化为易读的缩进格式 | `Alt + F` |
| **压缩**   | 将 JSON 压缩成一行             | -         |

<!-- screenshot: 格式化前后的对比效果 -->

### 转义与反转义

处理嵌套的字符串数据：

| 按钮       | 功能                           |
| ---------- | ------------------------------ |
| **转义**   | 将内容包装成 JSON 字符串值     |
| **反转义** | 将 JSON 字符串值还原为原始内容 |

适用场景：当 Schema 中包含嵌套的 JSON 字符串时。

### 解析（Deserialize）

将多层嵌套或转义的 JSON 字符串自动解析为结构化数据。

### JSON 智能修复

当 JSON 存在语法错误时，编辑器会：

1. 显示错误提示和错误位置
2. 尝试智能修复常见错误
3. 提供一键修复功能

<!-- screenshot: JSON 错误提示和修复按钮 -->

## AST 智能补全

编辑 AST (Elements[]) 类型数据时，编辑器提供智能补全功能。

### 功能特性

- 🎯 **上下文感知** - 根据光标位置智能推断可用字段
- ⚡ **实时补全** - 输入时自动触发补全提示
- 📚 **类型提示** - 显示字段类型和描述信息

<!-- screenshot: AST 智能补全的效果 -->

### 触发方式

| 方式                   | 说明                   |
| ---------------------- | ---------------------- |
| **自动触发**           | 输入时自动显示补全提示 |
| `Cmd + .` / `Ctrl + .` | 手动触发补全           |
| `Alt + /`              | 备用快捷键             |

### 支持的补全内容

**Element 类型值**（21 种）：

- `paragraph`, `heading-one`, `heading-two`, `heading-three`
- `link`, `image`, `code-block`, `code-line`
- `bulleted-list`, `numbered-list`, `list-item`
- 等等...

**Element 字段名**（37+ 个）：

- `type`, `children`, `text`, `id`, `class`
- `bold`, `italic`, `underline`, `code`
- `url`, `title`, `level`, `language`
- 等等...

### 启用/禁用

在配置页面「编辑器配置」→「编辑器功能」中可以开启或关闭 AST 类型提示。

## 编辑器主题

Schema Element Editor 支持多种编辑器主题：

| 主题                                   | 说明                                     |
| -------------------------------------- | ---------------------------------------- |
| **Schema Element Editor Dark**（默认） | 自定义深色主题，优化了括号匹配和语法高亮 |
| **Dark**                               | 标准深色主题                             |
| **Light**                              | 浅色主题                                 |

<!-- screenshot: 三种主题的对比效果 -->

在工具栏点击主题切换按钮即可切换。主题选择会自动保存。

## 主题色配置

您可以自定义插件的主题色，用于配置页面和编辑器界面的高亮颜色。

在配置页面「编辑器配置」→「外观设置」中设置。

<!-- screenshot: 主题色选择器 -->

## 快捷键

### 编辑器内快捷键

| 快捷键            | 功能                  | 可自定义 |
| ----------------- | --------------------- | -------- |
| `Alt + S`         | 保存                  | ✅       |
| `Alt + F`         | 格式化                | ✅       |
| `Alt + P`         | 打开/更新预览         | ✅       |
| `Shift + Alt + P` | 关闭预览              | ✅       |
| `Cmd/Ctrl + .`    | 触发 AST 补全         | ❌       |
| `Alt + /`         | 触发 AST 补全（备用） | ❌       |

### 自定义快捷键

在配置页面「快捷键配置」中，您可以自定义编辑器内的快捷键：

1. 点击快捷键输入框
2. 按下想要的快捷键组合
3. 配置自动保存

<!-- screenshot: 快捷键配置界面 -->

**注意事项：**

- 快捷键必须包含 `Ctrl/Cmd` 或 `Alt` 修饰键
- 避免使用浏览器保留快捷键（如 `Cmd+W`、`Cmd+T`）
- 快捷键仅在编辑器获得焦点时生效

## Markdown 字符串自动解析

当获取的 Schema 数据为字符串类型时，插件可以自动将其解析为 Markdown Elements 结构。

### 工作原理

1. 页面返回 Markdown 字符串
2. 插件自动解析为 Elements[] 结构
3. 编辑器以 AST 模式显示
4. 保存时自动转换回 Markdown 字符串

### 适用场景

- AI 智能体对话场景
- 符合 Agentic UI 数据规范的页面

### 启用/禁用

在配置页面「编辑器配置」→「编辑器功能」→「字符串自动解析」中设置。

默认开启。

## 功能开关

您可以在配置页面「功能开关」中控制工具栏按钮的显示：

| 功能               | 说明               |
| ------------------ | ------------------ |
| AST/RawString 切换 | 内容类型切换按钮   |
| 转义/反转义        | 字符串转义相关按钮 |
| 解析               | Deserialize 按钮   |
| 压缩               | Serialize 按钮     |
| 格式化             | Format 按钮        |
| 预览               | Preview 按钮       |
| 导入导出           | Import/Export 按钮 |

<!-- screenshot: 功能开关配置界面 -->

如果您只需要基础编辑功能，可以点击「一键精简」关闭所有附加功能。

## 故障排除

### JSON 格式错误无法保存

1. 查看编辑器底部的错误提示
2. 点击「定位错误」跳转到错误位置
3. 尝试点击「智能修复」
4. 手动修正 JSON 语法

### AST 补全不工作

1. 确认数据类型为 AST（Elements[]）
2. 检查配置中「AST 类型提示」是否开启
3. 尝试手动触发：`Cmd/Ctrl + .`

### 快捷键无响应

1. 确保编辑器获得焦点（点击编辑区域）
2. 检查快捷键是否与浏览器或系统快捷键冲突
3. 在配置页面检查快捷键设置
