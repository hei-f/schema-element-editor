# Schema Editor

ä¸€ä¸ªå¼ºå¤§çš„Chromeæ‰©å±•ç¨‹åºï¼Œç”¨äºæŸ¥çœ‹å’Œç¼–è¾‘DOMå…ƒç´ çš„Schemaæ•°æ®ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¯ **æ™ºèƒ½å…ƒç´ æ£€æµ‹**ï¼šæŒ‰ä½ Alt/Option é”®æ‚¬åœæ—¶è‡ªåŠ¨æ£€æµ‹å…ƒç´ çš„ `data-schema-params` å±æ€§ï¼ˆå¯è‡ªå®šä¹‰å±æ€§åï¼‰
  - æ”¯æŒåµŒå¥—å…ƒç´ æ™ºèƒ½æ£€æµ‹ï¼Œè‡ªåŠ¨æ‰¾åˆ°æœ€è¿‘çš„å¸¦å±æ€§å…ƒç´ 
  - å¯é…ç½®å‘ä¸‹/å‘ä¸Šæœç´¢æ·±åº¦ï¼ˆé»˜è®¤5å±‚ä¸‹ï¼Œ3å±‚ä¸Šï¼‰
  - è‡ªåŠ¨å¤„ç† `pointer-events: none` ç­‰ç‰¹æ®Šæ ·å¼
- ğŸ¨ **å¯è§†åŒ–é«˜äº®**ï¼šç”¨å‹å¥½çš„æ ·å¼æ ‡è®°ç›®æ ‡å…ƒç´ 
- ğŸ“ **Schemaç¼–è¾‘**ï¼šå†…ç½®ä»£ç ç¼–è¾‘å™¨ç¼–è¾‘JSON Schema
- ğŸ’¾ **ä¸€é”®æ›´æ–°**ï¼šä¿®æ”¹åç›´æ¥æ›´æ–°é¡µé¢Schema
- ğŸ”„ **æ ¼å¼åŒ–å·¥å…·**ï¼šå†…ç½®JSONæ ¼å¼åŒ–å’Œæ ¡éªŒåŠŸèƒ½
- ğŸ›ï¸ **çŠ¶æ€æŒä¹…åŒ–**ï¼šè®°ä½æ¿€æ´»çŠ¶æ€å’Œåå¥½è®¾ç½®
- ğŸ›¡ï¸ **é˜²è¯¯è§¦è®¾è®¡**ï¼šä»…åœ¨æŒ‰ä½ Alt/Option é”®æ—¶å¯ç”¨æ£€æµ‹åŠŸèƒ½
- âš™ï¸ **é«˜çº§é…ç½®**ï¼šåœ¨é…ç½®é¡µé¢å¯è‡ªå®šä¹‰å±æ€§åç§°ã€æœç´¢æ·±åº¦ã€èŠ‚æµé—´éš”ç­‰

## æŠ€æœ¯æ ˆ

- React 18 + TypeScript
- Vite + CRXJS
- Ant Design 5.x
- Monaco Editor (æœ¬åœ°æ‰“åŒ…)
- Styled Components
- Chrome Extension Manifest V3

## å¼€å‘æŒ‡å—

### å‰ç½®è¦æ±‚

- Node.js >= 16
- npm æˆ– tnpm

### å®‰è£…ä¾èµ–

```bash
tnpm install
```

### å¼€å‘æ¨¡å¼

```bash
tnpm run dev
```

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
tnpm run build
```

### æ‰“åŒ…åˆ†å‘

```bash
npm run package
```

### åŠ è½½åˆ°Chromeï¼ˆå¼€å‘æ¨¡å¼ï¼‰

1. æ‰“å¼€Chromeæµè§ˆå™¨
2. è®¿é—® `chrome://extensions/`
3. å¼€å¯å³ä¸Šè§’çš„"å¼€å‘è€…æ¨¡å¼"
4. ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"
5. é€‰æ‹©é¡¹ç›®çš„ `dist` ç›®å½•

## ä½¿ç”¨è¯´æ˜

### æ¿€æ´»æ’ä»¶

1. ç‚¹å‡»æµè§ˆå™¨å·¥å…·æ ä¸­çš„Schema Editorå›¾æ ‡
2. å›¾æ ‡çŠ¶æ€å˜åŒ–ï¼š
   - **æ¿€æ´»æ—¶**ï¼šå›¾æ ‡æ˜¾ç¤º ğŸŸ¢ **ç»¿è‰²**å¹½çµ
   - **åœç”¨æ—¶**ï¼šå›¾æ ‡æ˜¾ç¤º âš« **ç°è‰²**å¹½çµ
   - æ ‡é¢˜æ˜¾ç¤ºï¼š`Schema Editor - å·²æ¿€æ´» âœ“` æˆ– `Schema Editor - æœªæ¿€æ´»`

### æ£€æŸ¥å…ƒç´ 

1. æ¿€æ´»æ’ä»¶åï¼ŒæŒ‰ä½ Alt é”®ï¼ˆMac ä½¿ç”¨ Option é”®ï¼‰
2. å°†é¼ æ ‡æ‚¬åœåœ¨é¡µé¢å…ƒç´ ä¸Š
3. æœ‰æ•ˆå…ƒç´ æ˜¾ç¤ºé«˜äº®è¾¹æ¡†å’Œå±æ€§å€¼
4. æ— æ•ˆå…ƒç´ æ˜¾ç¤º"éæ³•ç›®æ ‡"æç¤º
5. é‡Šæ”¾æŒ‰é”®åé«˜äº®æ¶ˆå¤±

### ç¼–è¾‘Schema

1. æŒ‰ä½ Alt/Option é”®å¹¶ç‚¹å‡»é«˜äº®çš„å…ƒç´ 
2. å³ä¾§æŠ½å±‰æ‰“å¼€ï¼Œæ˜¾ç¤ºSchemaæ•°æ®
3. ç¼–è¾‘JSONå†…å®¹
4. ç‚¹å‡»"æ ¼å¼åŒ–"ç¾åŒ–JSON
5. ç‚¹å‡»"ä¿å­˜"æ›´æ–°Schema

### åœç”¨æ’ä»¶

ç‚¹å‡»å·¥å…·æ å›¾æ ‡åœç”¨ã€‚

## é¡µé¢é›†æˆè¦æ±‚

æ’ä»¶éœ€è¦é¡µé¢æä¾›ä»¥ä¸‹å…¨å±€æ–¹æ³•ï¼š

### `window.__getSchemaByParams(params)`

```typescript
window.__getSchemaByParams = (params) => {
  // params: string, ä¾‹å¦‚ 'param1' æˆ– 'param1,param2'
  return { /* Schemaå¯¹è±¡ */ }
}
```

### `window.__updateSchemaByParams(schema, params)`

```typescript
window.__updateSchemaByParams = (schema, params) => {
  // æ›´æ–°Schema
  return true // æˆåŠŸè¿”å›true
}
```

### å…ƒç´ æ ‡è®°æ–¹å¼

```html
<!-- å•ä¸ªå‚æ•° -->
<div data-schema-params="param1"></div>

<!-- å¤šä¸ªå‚æ•°ï¼ˆé€—å·åˆ†éš”ï¼‰-->
<div data-schema-params="msg-001,comp-001"></div>
```

## é¡¹ç›®ç»“æ„

```
ChromeTools/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ manifest.json          # Chromeæ‰©å±•é…ç½®
â”‚   â”œâ”€â”€ background/            # Background Service Worker
â”‚   â”‚   â””â”€â”€ service-worker.ts
â”‚   â”œâ”€â”€ content/               # Content Scripts
â”‚   â”‚   â”œâ”€â”€ index.tsx          # å…¥å£æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ monitor.ts         # å…ƒç´ ç›‘å¬å™¨
â”‚   â”‚   â””â”€â”€ ui/                # React UIç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ App.tsx
â”‚   â”‚       â”œâ”€â”€ SchemaDrawer.tsx
â”‚   â”‚       â”œâ”€â”€ Tooltip.tsx
â”‚   â”‚       â””â”€â”€ styles.ts
â”‚   â”œâ”€â”€ options/               # é…ç½®é¡µé¢
â”‚   â”‚   â”œâ”€â”€ options.html
â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â””â”€â”€ OptionsApp.tsx
â”‚   â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ message.ts
â”‚   â”‚   â”œâ”€â”€ storage.ts
â”‚   â”‚   â”œâ”€â”€ element-detector.ts
â”‚   â”‚   â”œâ”€â”€ json-serializer.ts
â”‚   â”‚   â””â”€â”€ monaco-loader.ts
â”‚   â””â”€â”€ types/                 # TypeScriptç±»å‹å®šä¹‰
â”‚       â””â”€â”€ index.ts
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ injected.js            # é¡µé¢æ³¨å…¥è„šæœ¬
â”‚   â””â”€â”€ icons/                 # æ‰©å±•å›¾æ ‡
â”‚       â”œâ”€â”€ gen.py             # å›¾æ ‡ç”Ÿæˆè„šæœ¬
â”‚       â”œâ”€â”€ icon-active-*.png  # æ¿€æ´»æ€å›¾æ ‡
â”‚       â””â”€â”€ icon-inactive-*.png # æœªæ¿€æ´»æ€å›¾æ ‡
â”œâ”€â”€ test/                      # æµ‹è¯•ç›¸å…³
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tsconfig.json
â””â”€â”€ package.json
```

## æ¶æ„è¯´æ˜

### é€šä¿¡æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»å›¾æ ‡
  â†“
Background Service Workeråˆ‡æ¢çŠ¶æ€
  â†“
é€šçŸ¥Content Script
  â†“
Content Scriptç›‘å¬æŒ‰é”®å’Œhover
  â†“
ç”¨æˆ·æŒ‰ä½Alt/Optioné”® + hoverå…ƒç´  â†’ æ˜¾ç¤ºé«˜äº®
  â†“
ç”¨æˆ·æŒ‰ä½Alt/Optioné”® + ç‚¹å‡»å…ƒç´ 
  â†“
æ‡’åŠ è½½React UIï¼ˆé¦–æ¬¡ï¼‰
  â†“
è°ƒç”¨window.__getSchemaByParams()
  â†“
ç¼–è¾‘å™¨å±•ç¤ºJSON
  â†“
ç”¨æˆ·ç¼–è¾‘å¹¶ä¿å­˜
  â†“
è°ƒç”¨window.__updateSchemaByParams()
  â†“
æ˜¾ç¤ºæ›´æ–°ç»“æœ
```

## æ³¨æ„äº‹é¡¹

1. å›¾æ ‡é¢œè‰²ï¼šç»¿è‰²=æ¿€æ´»ï¼Œç°è‰²=æœªæ¿€æ´»
2. é¡µé¢å¿…é¡»æä¾› `window.__getSchemaByParams` å’Œ `window.__updateSchemaByParams` æ–¹æ³•
3. å…ƒç´ å¿…é¡»å…·æœ‰ `data-schema-params` å±æ€§ï¼ˆå¯åœ¨é…ç½®é¡µé¢è‡ªå®šä¹‰å±æ€§åï¼‰
4. å±æ€§å€¼æ”¯æŒå•ä¸ªå‚æ•°æˆ–é€—å·åˆ†éš”çš„å¤šä¸ªå‚æ•°
5. é…ç½®é¡µé¢ï¼šå³é”®ç‚¹å‡»å›¾æ ‡ â†’ é€‰é¡¹

## è®¸å¯è¯

MIT
