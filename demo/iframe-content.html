<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>iframe æµ‹è¯•å†…å®¹</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 20px;
      background: #fff;
    }
    .header {
      background: linear-gradient(135deg, #e6fffb 0%, #87e8de 100%);
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #5cdbd3;
    }
    .header h3 {
      color: #006d75;
      margin-bottom: 8px;
    }
    .header p {
      color: #08979c;
      font-size: 13px;
    }
    .test-element {
      padding: 16px;
      border: 1px solid #d9d9d9;
      border-radius: 8px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.2s;
      background: #fff;
    }
    .test-element:hover {
      border-color: #1677ff;
      box-shadow: 0 2px 8px rgba(22, 119, 255, 0.2);
    }
    .test-element.valid {
      border-left: 4px solid #52c41a;
    }
    .test-element.invalid {
      border-left: 4px solid #ff4d4f;
    }
    .element-title {
      font-weight: 600;
      color: #262626;
      margin-bottom: 4px;
    }
    .element-desc {
      color: #8c8c8c;
      font-size: 12px;
    }
    .element-attr {
      font-family: 'Consolas', monospace;
      background: #f5f5f5;
      padding: 4px 8px;
      border-radius: 4px;
      margin-top: 8px;
      font-size: 11px;
      color: #595959;
    }
    .tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      margin-left: 8px;
    }
    .tag.success { background: #f6ffed; color: #389e0d; }
    .tag.error { background: #fff2f0; color: #cf1322; }
    .status {
      margin-top: 16px;
      padding: 12px;
      background: #f6ffed;
      border: 1px solid #b7eb8f;
      border-radius: 6px;
      font-size: 12px;
      color: #389e0d;
    }
    .status.error {
      background: #fff2f0;
      border-color: #ffccc7;
      color: #cf1322;
    }
  </style>
</head>
<body>
  <div class="header">
    <h3>ğŸ–¼ï¸ è¿™æ˜¯ iframe å†…éƒ¨</h3>
    <p>æŒ‰ä½ Alt/Option é”®æ‚¬åœåœ¨ä¸‹æ–¹å…ƒç´ ä¸Šï¼Œæµ‹è¯• iframe å†…å…ƒç´ æ£€æµ‹åŠŸèƒ½</p>
  </div>

  <div id="status" class="status">ğŸ’¡ æŒ‰ä½ Alt/Option é”®æ‚¬åœæµ‹è¯•</div>

  <div class="test-element valid" data-id="iframe-element-1">
    <div class="element-title">
      iframe å…ƒç´  1
      <span class="tag success">æœ‰æ•ˆ</span>
    </div>
    <div class="element-desc">è¿™æ˜¯ iframe å†…éƒ¨çš„ç¬¬ä¸€ä¸ªæµ‹è¯•å…ƒç´ </div>
    <div class="element-attr">data-id="iframe-element-1"</div>
  </div>

  <div class="test-element valid" data-id="iframe-element-2">
    <div class="element-title">
      iframe å…ƒç´  2
      <span class="tag success">æœ‰æ•ˆ</span>
    </div>
    <div class="element-desc">è¿™æ˜¯ iframe å†…éƒ¨çš„ç¬¬äºŒä¸ªæµ‹è¯•å…ƒç´ </div>
    <div class="element-attr">data-id="iframe-element-2"</div>
  </div>

  <div class="test-element valid" data-id="iframe-nested-object">
    <div class="element-title">
      åµŒå¥—å¯¹è±¡æ•°æ®
      <span class="tag success">æœ‰æ•ˆ</span>
    </div>
    <div class="element-desc">Schema ä¸ºåµŒå¥—å¯¹è±¡ï¼Œç”¨äºæµ‹è¯•å¤æ‚æ•°æ®</div>
    <div class="element-attr">data-id="iframe-nested-object"</div>
  </div>

  <div class="test-element invalid">
    <div class="element-title">
      æ— æ•ˆå…ƒç´ 
      <span class="tag error">éæ³•</span>
    </div>
    <div class="element-desc">æ²¡æœ‰ data-id å±æ€§ï¼Œåº”æ˜¾ç¤º"éæ³•ç›®æ ‡"</div>
  </div>

  <script>
    // postMessage æ¨¡å¼æ¶ˆæ¯æ¥æºæ ‡è¯†
    const MESSAGE_SOURCE = {
      CONTENT: 'schema-element-editor-content',
      HOST: 'schema-element-editor-host',
    };

    // iframe å†…éƒ¨çš„ Schema æ•°æ®
    const schemaStore = {
      'iframe-element-1': {
        title: 'iframe å…ƒç´  1 çš„ Schema',
        description: 'æ¥è‡ª iframe å†…éƒ¨',
        value: 123
      },
      'iframe-element-2': ['apple', 'banana', 'cherry'],
      'iframe-nested-object': {
        user: { name: 'Alice', age: 25 },
        settings: { theme: 'dark', lang: 'zh-CN' }
      }
    };

    // ç›‘å¬æ¥è‡ªæ’ä»¶çš„ postMessage
    window.addEventListener('message', (event) => {
      // åªå¤„ç†æ¥è‡ªæ’ä»¶çš„è¯·æ±‚
      if (!event.data || event.data.source !== MESSAGE_SOURCE.CONTENT) return;

      const { type, payload, requestId } = event.data;
      let result;

      switch (type) {
        case 'GET_SCHEMA': {
          const schema = schemaStore[payload.params];
          if (schema !== undefined) {
            result = { success: true, data: schema };
            console.log('[iframe] è¿”å› Schema:', payload.params, schema);
          } else {
            result = { success: true, data: { error: 'Schema not found in iframe', params: payload.params } };
            console.log('[iframe] Schema æœªæ‰¾åˆ°:', payload.params);
          }
          break;
        }

        case 'UPDATE_SCHEMA': {
          schemaStore[payload.params] = payload.schema;
          result = { success: true };
          console.log('[iframe] Schema å·²æ›´æ–°:', payload.params, payload.schema);
          break;
        }

        case 'CHECK_PREVIEW': {
          result = { exists: false }; // iframe å†…æš‚ä¸æ”¯æŒé¢„è§ˆ
          break;
        }

        default:
          result = { success: false, error: 'Unknown type: ' + type };
      }

      // å‘é€å“åº”ç»™ top frame
      window.parent.postMessage({
        source: MESSAGE_SOURCE.HOST,
        requestId,
        ...result
      }, '*');
    });

    console.log('[iframe] postMessage ç›‘å¬å™¨å·²æ³¨å†Œ');
  </script>
</body>
</html>

